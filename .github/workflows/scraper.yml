name: Global Media Scraper

on:
  schedule:
    - cron: '0 0 * * 0' # ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø£Ø­Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„
  workflow_dispatch: # Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ

jobs:
  scrape_all:
    runs-on: ubuntu-latest
    timeout-minutes: 300 # 5 Ø³Ø§Ø¹Ø§Øª ÙƒØ§Ù…Ù„Ø© Ù„ÙŠØ¹Ù…Ù„ Ø§Ù„Ø³Ø­Ø¨ Ø¨Ø±Ø§Ø­ØªÙ‡ Ø¯ÙˆÙ† Ø§Ù†Ù‚Ø·Ø§Ø¹
    
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4 # ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹ (Ø£Ø³Ø±Ø¹ ÙˆØ£ÙƒØ«Ø± Ø£Ù…Ø§Ù†Ø§Ù‹)
        with:
          fetch-depth: 0 

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install playwright requests beautifulsoup4
          python -m playwright install chromium

      - name: Run All Scrapers
        run: |
          echo "ğŸš€ Ø¨Ø¯Ø¡ Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹..."
          
          # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨ØªØ§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø­ØªÙ‰ Ù„Ùˆ Ø³Ù‚Ø· Ù…ÙˆÙ‚Ø¹
         
          python akoam_movies_scraper.py || true
          python akoam_series_scraper.py || true
          python mycima_movies_scraper.py || true
          python mycima_series_scraper.py || true
          python fushaar_movies_scraper.py || true
          python fushaar_series_scraper.py || true
          python egibest_movies_scraper.py || true
          python egibest_series_scraper.py || true
          python laroza_movies_scraper.py || true
          python laroza_series_scraper.py || true
          python 123movies_movies_scraper.py || true
          python 123movies_series_scraper.py || true
          
          echo "ğŸ”— Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©..."
          python main.py || echo "âš ï¸ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"

      - name: Commit and Push Changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          git fetch origin main
          git add *.json
          
          # Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙ‚Ø· ÙÙŠ Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©
          git commit -m "Update all media data: $(date +'%Y-%m-%d %H:%M')" || exit 0
          
          # Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Rebase Ø°ÙƒÙŠØ©: Ù„Ùˆ Ø­Ø¯Ø« ØªØ¹Ø§Ø±Ø¶ØŒ Ø§Ø¹ØªÙ…Ø¯ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙˆØ±Ø§Ù‹ (X ours)
          git pull origin main --rebase -X ours
          
          git push origin main
