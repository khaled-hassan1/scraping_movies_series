name: Global Media Scraper

on:
  schedule:
    - cron: '0 0 * * 0' # ╪г╪│╪и┘И╪╣┘К╪з┘Л (╪з┘Д╪г╪н╪п ╪з┘Д╪│╪з╪╣╪й 12 ┘Е┘Ж╪к╪╡┘Б ╪з┘Д┘Д┘К┘Д)
  workflow_dispatch: # ╪е┘Е┘Г╪з┘Ж┘К╪й ╪з┘Д╪к╪┤╪║┘К┘Д ╪з┘Д┘К╪п┘И┘К ┘Д┘Д╪к╪н┘В┘В ┘Е┘Ж ╪з┘Д┘Ж╪к╪з╪ж╪м

jobs:
  scrape_all:
    runs-on: ubuntu-latest

    # ╪з┘Д╪│┘Е╪з╪н ┘Д┘Д╪г┘Г╪┤┘Ж ╪и╪з┘Д┘Г╪к╪з╪и╪й ┘Б┘К ╪з┘Д┘Е╪│╪к┘И╪п╪╣
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # ╪│╪н╪и ┘Г╪з┘Е┘Д ╪з┘Д╪к╪з╪▒┘К╪о ┘Д╪к╪м┘Ж╪и ┘Е╪┤╪з┘Г┘Д ╪з┘Д┘А Rebase

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          # ╪к╪л╪и┘К╪к ╪з┘Д┘Е┘Г╪к╪и╪з╪к ╪з┘Д┘Е╪╖┘Д┘И╪и╪й ┘Д╪м┘Е┘К╪╣ ╪з┘Д┘Е┘И╪з┘В╪╣
          pip install playwright requests beautifulsoup4
          # ╪к╪л╪и┘К╪к ┘Е╪к╪╡┘Б╪н Chromium ╪з┘Д┘Е╪╖┘Д┘И╪и ┘Д┘А Playwright
          playwright install chromium

      - name: Run All Scrapers
        run: |
          echo "ЁЯЪА ╪з┘Д╪и╪п╪б ┘Б┘К ╪╣┘Е┘Д┘К╪й ╪│╪н╪и ╪з┘Д╪и┘К╪з┘Ж╪з╪к ┘Е┘Ж ╪м┘Е┘К╪╣ ╪з┘Д┘Е╪╡╪з╪п╪▒..."
          
          # ┘Е┘Д╪з╪н╪╕╪й: ╪з╪│╪к╪о╪п┘Е┘Ж╪з "|| true" ┘Д╪╢┘Е╪з┘Ж ╪з╪│╪к┘Е╪▒╪з╪▒ ╪з┘Д╪╣┘Е┘Д┘К╪й ╪н╪к┘Й ┘Д┘И ┘Б╪┤┘Д ╪г╪н╪п ╪з┘Д╪│┘Г╪▒┘К╪и╪к╪з╪к
          python akoam_movies_scraper.py || true
          python akoam_series_scraper.py || true
          python mycima_movies_scraper.py || true
          python mycima_series_scraper.py || true
          python fushaar_movies_scraper.py || true
          python fushaar_series_scraper.py || true
          python egibest_movies_scraper.py || true
          python egibest_series_scraper.py || true
          python laroza_movies_scraper.py || true
          python laroza_series_scraper.py || true
          
          # ╪п┘Е╪м ┘Г┘Д ╪з┘Д┘Ж╪к╪з╪ж╪м ┘Б┘К ╪з┘Д┘Е┘Д┘Б ╪з┘Д┘Ж┘З╪з╪ж┘К all_data.json
          python main.py || echo "тЪая╕П ┘Б╪┤┘Д ╪п┘Е╪м ╪з┘Д╪и┘К╪з┘Ж╪з╪к ╪з┘Д┘Ж┘З╪з╪ж┘К╪й"

      - name: Commit and Push Changes
        run: |
          # ╪е╪╣╪п╪з╪п ┘З┘И┘К╪й ╪з┘Д╪и┘И╪к
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # ╪е╪╢╪з┘Б╪й ╪м┘Е┘К╪╣ ┘Е┘Д┘Б╪з╪к JSON ╪з┘Д┘Ж╪з╪к╪м╪й
          git add *.json
          
          # ╪╣┘Е┘Д ╪з┘Д┘А Commit ┘Е╪╣ ╪к╪м╪з┘З┘Д ╪з┘Д╪о╪╖╪г ╪е╪░╪з ┘Д┘Е ╪к┘Г┘Ж ┘З┘Ж╪з┘Г ╪к╪║┘К┘К╪▒╪з╪к
          git commit -m "Update all media data: $(date +'%Y-%m-%d %H:%M')" || exit 0
          
          # ╪з┘Д╪к╪н╪п┘К╪л ┘Е┘Ж ╪з┘Д┘Е╪│╪к┘И╪п╪╣ ┘Е╪╣ ╪н┘Д ╪з┘Д╪к╪╣╪з╪▒╪╢╪з╪к ┘Д╪╡╪з┘Д╪н ╪з┘Д┘Е┘Д┘Б╪з╪к ╪з┘Д╪м╪п┘К╪п╪й (╪з┘Д╪к┘К ╪к┘Е ╪│╪н╪и┘З╪з ╪з┘Д╪в┘Ж)
          # ╪з╪│╪к╪▒╪з╪к┘К╪м┘К╪й -X ours ╪к╪╣┘Ж┘К: "┘Б┘К ╪н╪з┘Д ┘И╪м┘И╪п ╪к╪╣╪з╪▒╪╢╪М ╪з╪╣╪к┘Е╪п ╪з┘Д┘Ж╪│╪о╪й ╪з┘Д┘Е┘И╪м┘И╪п╪й ╪н╪з┘Д┘К╪з┘Л ┘Б┘К ╪з┘Д┘А Runner"
          git pull origin main --rebase -X ours
          
          # ╪з┘Д╪▒┘Б╪╣ ╪з┘Д┘Ж┘З╪з╪ж┘К ┘Д┘Д┘Е╪│╪к┘И╪п╪╣
          git push origin main