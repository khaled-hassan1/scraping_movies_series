name: Global Media Scraper

on:
  schedule:
    - cron: '0 0 * * 0' # ╪к╪┤╪║┘К┘Д ╪к┘Д┘В╪з╪ж┘К ┘Г┘Д ╪г╪н╪п ╪з┘Д╪│╪з╪╣╪й 12 ┘Е┘Ж╪к╪╡┘Б ╪з┘Д┘Д┘К┘Д
  workflow_dispatch: # ╪е┘Е┘Г╪з┘Ж┘К╪й ╪з┘Д╪к╪┤╪║┘К┘Д ╪з┘Д┘К╪п┘И┘К ┘Е┘Ж ╪к╪и┘И┘К╪и Actions

jobs:
  scrape_all:
    runs-on: ubuntu-latest

    # ╪╡┘Д╪з╪н┘К╪з╪к ╪з┘Д┘Г╪к╪з╪и╪й ╪╢╪▒┘И╪▒┘К╪й ┘Д╪▒┘Б╪╣ ┘Е┘Д┘Б╪з╪к JSON ╪з┘Д╪м╪п┘К╪п╪й
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # ╪│╪н╪и ┘Г╪з┘Е┘Д ╪к╪з╪▒┘К╪о ╪з┘Д╪з┘Д╪к╪▓╪з┘Е╪з╪к ┘Д╪╢┘Е╪з┘Ж ┘Ж╪м╪з╪н ╪╣┘Е┘Д┘К╪й ╪з┘Д┘А Rebase

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install playwright requests beautifulsoup4
          playwright install chromium

      - name: Run All Scrapers
        run: |
          echo "ЁЯЪА ╪и╪п╪б ╪╣┘Е┘Д┘К╪й ╪│╪н╪и ╪з┘Д╪и┘К╪з┘Ж╪з╪к ┘Е┘Ж ╪м┘Е┘К╪╣ ╪з┘Д┘Е┘И╪з┘В╪╣..."
          
          # ╪к╪┤╪║┘К┘Д ╪│┘Г╪▒┘К╪и╪к╪з╪к ╪з┘Д╪г┘Б┘Д╪з┘Е ┘И╪з┘Д┘Е╪│┘Д╪│┘Д╪з╪к (╪е╪╢╪з┘Б╪й || true ┘Д╪╢┘Е╪з┘Ж ╪з╪│╪к┘Е╪▒╪з╪▒ ╪з┘Д╪╣┘Е┘Д ┘Б┘К ╪н╪з┘Д ╪к╪╣╪╖┘Д ╪г╪н╪п ╪з┘Д┘Е┘И╪з┘В╪╣)
          python akoam_movies_scraper.py || true
          python akoam_series_scraper.py || true
          python mycima_movies_scraper.py || true
          python mycima_series_scraper.py || true
          python fushaar_movies_scraper.py || true
          python fushaar_series_scraper.py || true
          python egibest_movies_scraper.py || true
          python egibest_series_scraper.py || true
          python laroza_movies_scraper.py || true
          python laroza_series_scraper.py || true
          
          # ╪п┘Е╪м ╪з┘Д┘Ж╪к╪з╪ж╪м ┘Б┘К ╪з┘Д┘Е┘Д┘Б ╪з┘Д┘Ж┘З╪з╪ж┘К
          python main.py || echo "тЪая╕П ┘Б╪┤┘Д ┘Б┘К ╪п┘Е╪м ╪з┘Д╪и┘К╪з┘Ж╪з╪к ╪з┘Д┘Ж┘З╪з╪ж┘К╪й"

      - name: Commit and Push Changes
        run: |
          # ╪е╪╣╪п╪з╪п ┘З┘И┘К╪й ╪з┘Д╪и┘И╪к ╪з┘Д╪░┘К ╪│┘К┘В┘И┘Е ╪и╪з┘Д╪▒┘Б╪╣
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # 1. ╪м┘Д╪и ╪з┘Д╪к╪н╪п┘К╪л╪з╪к ┘Е┘Ж ╪з┘Д╪│┘К╪▒┘Б╪▒ (Fetch) ╪и╪п┘И┘Ж ╪п┘Е╪м┘З╪з ┘Д╪к╪м┘Ж╪и ╪з┘Д╪╡╪п╪з┘Е ╪з┘Д┘Е╪и╪з╪┤╪▒
          git fetch origin main

          # 2. ╪е╪╢╪з┘Б╪й ┘Г╪з┘Б╪й ┘Е┘Д┘Б╪з╪к JSON ╪з┘Д┘Ж╪з╪к╪м╪й
          git add *.json
          
          # 3. ╪╣┘Е┘Д ╪з┘Д╪к╪▓╪з┘Е (Commit) ┘Е╪н┘Д┘К ╪и╪з┘Д╪к╪║┘К┘К╪▒╪з╪к ╪з┘Д╪м╪п┘К╪п╪й
          git commit -m "Update all media data: $(date +'%Y-%m-%d %H:%M')" || exit 0
          
          # 4. ╪н┘Д ╪з┘Д╪к╪╣╪з╪▒╪╢ ╪з┘Д╪м╪░╪▒┘К:
          # ┘Ж╪│╪к╪о╪п┘Е pull --rebase ┘Е╪╣ ╪з╪│╪к╪▒╪з╪к┘К╪м┘К╪й -X ours 
          # ┘З╪░╪з ╪з┘Д╪│╪╖╪▒ ┘К╪╣┘Ж┘К: ┘Д┘И ╪н╪п╪л ╪к╪╣╪з╪▒╪╢ ┘Б┘К ┘Е┘Д┘Б╪з╪к ╪з┘Д┘А JSON╪М ╪з╪н╪░┘Б ╪з┘Д┘В╪п┘К┘Е ┘И╪з╪╣╪к┘Е╪п ┘Е┘Д┘Б╪з╪к ╪з┘Д╪│┘Г╪▒┘К╪и╪к ╪з┘Д╪н╪з┘Д┘К╪й ┘Б┘И╪▒╪з┘Л
          git pull origin main --rebase -X ours

          # 5. ┘Е╪н╪з┘И┘Д╪й ╪з┘Д╪▒┘Б╪╣ ╪з┘Д┘Ж┘З╪з╪ж┘К ┘Д┘Д╪│┘К╪▒┘Б╪▒
          git push origin main
